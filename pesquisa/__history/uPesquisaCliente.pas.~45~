unit uPesquisaCliente;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB, Vcl.StdCtrls, Vcl.Grids,
  Vcl.DBGrids, Vcl.ExtCtrls, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf,
  FireDAC.DApt.Intf, FireDAC.Stan.Async, FireDAC.DApt, FireDAC.Comp.DataSet,
  FireDAC.Comp.Client, udmConexao;

type
  TfrmPesquisaCliente = class(TForm)
    pnTopPesquisa: TPanel;
    pnBottomPesquisa: TPanel;
    dbPesquisaCliente: TDBGrid;
    cbPesquisa: TComboBox;
    edPesquisa: TEdit;
    lbPesquisa: TLabel;
    btConsulta: TButton;
    btConfirmar: TButton;
    btFechar: TButton;
    qryPesquisaCliente: TFDQuery;
    dstPesquisaCliente: TDataSource;
    procedure btFecharClick(Sender: TObject);
    procedure btConsultaClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmPesquisaCliente: TfrmPesquisaCliente;

implementation

{$R *.dfm}

procedure TfrmPesquisaCliente.btFecharClick(Sender: TObject);
begin
  close;
end;

procedure TfrmPesquisaCliente.btConsultaClick(Sender: TObject);
begin

  qryPesquisaCliente.Close;
  qryPesquisaCliente.SQL.Clear;
  qryPesquisaCliente.SQL.Add('SELECT * FROM CLIENTE ');
  qryPesquisaCliente.SQL.Add('WHERE 1=1');

  if edPesquisa.Text <> '' then
  begin

    with qryPesquisaCliente do
      begin
        if cbPesquisa.text = 'codigo' then
        begin
          qryPesquisaCliente.SQL.Add('AND codigo = :codigo');
          qryPesquisaCliente.ParamByName('codigo').AsInteger := StrToIntDef(edPesquisa.Text, 0);
        end;

        if cbPesquisa.text = 'nome' then
        begin
          qryPesquisaCliente.SQL.Add('AND nome ILIKE :nome');
           qryPesquisaCliente.ParamByName('nome').AsString := '%' + edPesquisa.Text + '%';
        end;

        if cbPesquisa.text = 'data_cadastro' then
        begin
          qryPesquisaCliente.SQL.Add('AND data_cadastro = :data_cadastro');
          qryPesquisaCliente.ParamByName('data_cadastro').AsDate := StrToDateDef(edPesquisa.Text, 0);
        end;

        if cbPesquisa.text = 'cpf' then
        begin
          qryPesquisaCliente.SQL.Add('AND cpf ILIKE :cpf');
          qryPesquisaCliente.ParamByName('cpf').AsString := '%' + edPesquisa.Text + '%';
        end;

        if cbPesquisa.text = 'telefone' then
        begin
          qryPesquisaCliente.SQL.Add('AND telefone ILIKE :telefone');
          qryPesquisaCliente.ParamByName('telefone').AsString := '%' + edPesquisa.Text + '%';
        end;

        if cbPesquisa.text = 'email' then
        begin
          qryPesquisaCliente.SQL.Add('AND email ILIKE :email');
          qryPesquisaCliente.ParamByName('email').AsString := '%' + edPesquisa.Text + '%';
        end;

        if cbPesquisa.text = 'data_nascimento' then
        begin
          qryPesquisaCliente.SQL.Add('AND data_nascimento = :data_nascimento');
           qryPesquisaCliente.ParamByName('data_nascimento').AsDate := StrToDateDef(edPesquisa.Text, 0);
        end;

        if cbPesquisa.text = 'cep' then
        begin
          qryPesquisaCliente.SQL.Add('AND cep ILIKE :cep');
          qryPesquisaCliente.ParamByName('cep').AsString := '%' + edPesquisa.Text + '%';
        end;

        if cbPesquisa.text = 'bairro' then
        begin
          qryPesquisaCliente.SQL.Add('AND bairro ILIKE :bairro');
          qryPesquisaCliente.ParamByName('bairro').AsString := '%' + edPesquisa.Text + '%';
        end;

        if cbPesquisa.text = 'logradouro' then
        begin
          qryPesquisaCliente.SQL.Add('AND logradouro ILIKE '+QuotedStr('%:logradouro%')+'');
          qryPesquisaCliente.ParamByName('logradouro').AsString := edPesquisa.Text;
        end;

        if cbPesquisa.text = 'numero' then
        begin
          qryPesquisaCliente.SQL.Add('AND numero ILIKE '+QuotedStr('%:numero%')+'');
          qryPesquisaCliente.ParamByName('numero').AsString := edPesquisa.Text;
        end;

        if cbPesquisa.text = 'complemento' then
        begin
          qryPesquisaCliente.SQL.Add('AND complemento ILIKE '+QuotedStr('%:complemento%')+'');
          qryPesquisaCliente.ParamByName('complemento').AsString := edPesquisa.Text;
        end;

        if cbPesquisa.text = 'pais' then
        begin
          qryPesquisaCliente.SQL.Add('AND pais ILIKE '+QuotedStr('%:pais%')+'');
          qryPesquisaCliente.ParamByName('pais').AsString := edPesquisa.Text;
        end;

      end;

  end;

  qryPesquisaCliente.Open;

end;

procedure TfrmPesquisaCliente.FormShow(Sender: TObject);
var
  i : integer;
begin
  qryPesquisaCliente.Close;
  qryPesquisaCliente.SQL.Clear;
  qryPesquisaCliente.SQL.Add('SELECT * FROM CLIENTE');
  qryPesquisaCliente.Open;

  cbPesquisa.Items.Clear;

  for i:=0 to qryPesquisaCliente.FieldCount -1 do
  begin
    cbPesquisa.Items.Add(qryPesquisaCliente.Fields[i].FieldName);
  end;

  if cbPesquisa.Items.Count > 0 then
    cbPesquisa.ItemIndex := 0;

end;

end.
